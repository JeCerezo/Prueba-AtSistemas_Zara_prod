$(document).ready(function(){var g;var b=new Date().getTime();var i=60*1000*60*24;var h=function(){if(localStorage.getItem("lastUpdates")&&localStorage.getItem("podcastList")){if(parseInt(localStorage.getItem("lastUpdates"))+i<=b){d()}else{g=JSON.parse(localStorage.getItem("podcastList"));e(g.feed.entry)}}else{d()}};var d=function(){$("#loader").show();$.ajax({type:"GET",url:"https://itunes.apple.com/us/rss/toppodcasts/limit=100/genre=1310/json",dataType:"json",success:function(j){localStorage.setItem("podcastList",JSON.stringify(j));localStorage.setItem("lastUpdates",String(new Date().getTime()));g=j.feed.entry;e(g)},error:function(){console.log("no se ha cargado el json")},complete:function(){$("#loader").hide()}})};var e=function(j){if(j){$(".podcast-list").show();$("#search,#counter").show();$(".podcast-detail").hide();$("#episode").hide();console.log(j);$(".podcast-list").empty();$("#counter").text(j.length);$.each(j,function(l,k){$(".podcast-list").append("<div class='podcast' data-id='"+k.id.attributes["im:id"]+"'><img src='"+k["im:image"][2].label+"' alt='"+k["im:name"].label+"' /><h2>"+k["im:name"].label+"</h2>Author: <h3>"+k["im:artist"].label+"</h3></div>")});$(".podcast").click(function(k){var l=$(this).attr("data-id");console.log(l);if(localStorage.getItem(l)){if(parseInt(localStorage.getItem(l.TakeDate))+i<=b){c(l)}else{console.log(l);a(l)}}else{c(l)}page("/podcast/"+l)})}};var a=function(k){if(k){k=JSON.parse(localStorage.getItem(k));console.log(k);$(".podcast-list").hide();$(".podcast-detail").show();$(".podcast-detail").empty();$("#search,#counter").css("display","none");$(".podcast-detail").append("<div id='menuleft'><img src='"+k.image+"'/><h2>"+k.title+"</h2><h3>by "+k.author+"</h3><h4>Description:</h4><p id='description'>"+k.description+"</p></div><div id='counterright'></div><div id='list'><table><tr id='tabletitles'><td>Title</td><td>Date</td><td>Duration</td></tr></table></div>");$.each(k.episodes,function(l){$(".podcast-detail table").append("<tr class='tablefile'><td class='title'>"+k.episodes[l].title+"</td><td>"+k.episodes[l].date+"</td><td>"+k.episodes[l].duration+"</td></tr>");$("#counterright").text("Episodes: "+k.episodes.length)});var j=document.URL;console.log(j);$(".title").click(function(){var l=$(this).text();$.each(k.episodes,function(n,m){if(k.episodes[n].title==l){$("#episode").append("<h2>"+k.episodes[n].title+"</h2><p>"+k.episodes[n].description+"</p><audio src='"+k.episodes[n].audio+"' controls></audio>");window.history.replaceState(null,null,j+"/Episode/"+k.episodes[n].title)}});$("#episode").show();$("#counterright,#list").hide()});$("#menuleft").click(function(){$("#episode").empty().hide();$("#counterright,#list").show();window.history.replaceState(null,null,j)})}};$("#search").change(function(){filtro=$(this).val();if(filtro){var k=$.extend({},g);var j=k.feed.entry.filter(function(l){return l["im:name"].label.indexOf(filtro)!=-1||l["im:artist"].label.indexOf(filtro)!=-1});e(j)}else{$(".podcast").show();e(g.feed.entry)}}).keyup(function(){$(this).change()});var c=function(k){$("#loader").show();console.log(k);var j="https://crossorigin.me/https://itunes.apple.com/lookup?id="+k;$.ajax({type:"GET",url:j,dataType:"json",success:function(m){var l=m.results[0].feedUrl;f(l,k);console.log(l)},error:function(){console.log("no se ha cargado el json")},complete:function(){$("#loader").hide()}})};var f=function(j,k){$("#loader").show();$.ajax({type:"GET",url:"https://crossorigin.me/"+j,success:function(l){console.log(l);var m={TakeDate:String(new Date().getTime()),title:$(l).find("channel > title").text(),author:$(l).find("channel > copyright").text(),description:$(l).find("channel > description").text(),image:$(l).find("image > url").text(),episodes:[]};$(l).find("item").each(function(n){m.episodes.push({title:$(this).find("title").text(),description:$(this).find("description").text(),duration:$(this).find("itunes\\:duration").text(),date:$(this).find("pubDate").text(),audio:$(this).find("enclosure").attr("url")})});localStorage.setItem(k,JSON.stringify(m));a(k)},error:function(){console.log("no se ha cargado el json")},complete:function(){$("#loader").hide()}})};$("h1").click(function(){page("/")});page("/",h);page("/podcast/:id",function(j){var k=j.params.id;a(k)});page()});